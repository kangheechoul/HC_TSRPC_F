System.register("chunks:///_virtual/Arrow.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MathUtil.ts","./gameConfig.ts"],(function(t){"use strict";var e,r,i,o,s,n,a,c,l,h,u,d,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,n=t._decorator,a=t.Node,c=t.MeshRenderer,l=t.Color,h=t.Vec3,u=t.Component},function(t){d=t.MathUtil},function(t){p=t.gameConfig}],execute:function(){var m,_,P,w,f,v,g;s._RF.push({},"2330evjMPtBCJhzJpbQ/Kgk","Arrow",void 0);var y=n.ccclass,T=n.property;t("Arrow",(m=y("Arrow"),_=T(a),P=T(a),m((v=e((f=function(t){function e(){for(var e,r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return e=t.call.apply(t,[this].concat(s))||this,i(e,"arrow",v,o(e)),i(e,"circle",g,o(e)),e._startPos=new h,e._endPos=new h,e._startTime=0,e._endTime=0,e._isRemoved=!1,e}r(e,t);var s=e.prototype;return s.init=function(t,e,r){var i;this.id=t.id,this.state=t,this._startPos.set(e),this._endPos.set(t.targetPos.x,0,-t.targetPos.y),this._startTime=Date.now(),this._endTime=this._startTime+p.arrowFlyTime,this._updatePosAndForward(0),this.circle.setPosition(this._endPos.x,.1,this._endPos.z),null==(i=this.circle.getComponent(c))||i.material.setProperty("mainColor",new l(255,255,255,255))},s.update=function(){var t=d.limit((Date.now()-this._startTime)/(this._endTime-this._startTime),0,1);this._updatePosAndForward(t),t>=1&&this.remove()},s.remove=function(){var t,e=this;this._isRemoved||(this._isRemoved=!0,null==(t=this.circle.getComponent(c))||t.material.setProperty("mainColor",new l(255,0,0,255)),this.scheduleOnce((function(){e.node.removeFromParent()}),1))},s._updatePosAndForward=function(t){var e=this._getPos(t);this.arrow.position=e;var r=this._getPos(t-.01);this.arrow.forward=e.clone().subtract(r).normalize()},s._getPos=function(t){var e=this._startPos.clone().lerp(this._endPos,t);return e.y=7*Math.cos(t*Math.PI-Math.PI/2),e},e}(u)).prototype,"arrow",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=e(f.prototype,"circle",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=f))||w));s._RF.pop()}}}));

System.register("chunks:///_virtual/ArrowState.ts",["cc"],(function(){"use strict";var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"534d3Ycnr9H2pSTXpOvVac8","ArrowState",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/env.ts",["cc","./index3.mjs"],(function(){"use strict";var e;return{setters:[function(t){e=t.cclegacy},null],execute:function(){e._RF.push({},"0688cAvpN9MyYYi1PzlVhOQ","env",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/FollowCamera.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MathUtil.ts"],(function(t){"use strict";var e,o,r,i,s,n,a,l,c,u,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,r=t.createClass,i=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){n=t.cclegacy,a=t._decorator,l=t.Vec3,c=t.Node,u=t.Component},function(t){d=t.MathUtil}],execute:function(){var p,h,g,P,f,y;n._RF.push({},"db75bbNJnxHYIdxo63CSRnv","FollowCamera",void 0);var _=a.ccclass,w=a.property,m=new l;t("FollowCamera",(p=w(c),_((P=e((g=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,i(e,"focusTarget",P,s(e)),i(e,"speedFactor",f,s(e)),i(e,"_distance",y,s(e)),e.enableLimit=!0,e.minX=-1/0,e.maxX=1/0,e.minZ=-1/0,e.maxZ=1/0,e._tweenFollow=void 0,e._targetWorldPos=new l,e._lastTargetPos=new l,e}o(e,t);var n=e.prototype;return n.start=function(){this._lastTargetPos.set(this.focusTarget.worldPosition),this._updateTargetWorldPos(),this.node.setWorldPosition(this._targetWorldPos)},n._updateTargetWorldPos=function(){this._targetWorldPos.set(this.focusTarget.worldPosition),this.enableLimit&&(this._targetWorldPos.x=d.limit(this._targetWorldPos.x,this.minX,this.maxX),this._targetWorldPos.z=d.limit(this._targetWorldPos.z,this.minZ,this.maxZ)),this._targetWorldPos.add(this.node.forward.multiplyScalar(-1*this.distance))},n.update=function(){this._lastTargetPos.equals(this.focusTarget.worldPosition)||(this._lastTargetPos.set(this.focusTarget.worldPosition),this._updateTargetWorldPos()),m.set(this._targetWorldPos);var t=m.subtract(this.node.worldPosition);if(t.lengthSqr()>.01){var e=this.node.worldPosition.add(t.multiplyScalar(this.speedFactor));this.node.setWorldPosition(e)}},n.resetPos=function(){this._updateTargetWorldPos(),this.node.setWorldPosition(this._targetWorldPos)},r(e,[{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t,this._updateTargetWorldPos()}},{key:"preview",get:function(){return!1},set:function(t){this.resetPos()}},{key:"autoSetDistance",get:function(){return!1}},{key:"autuSetDistance",set:function(t){this.distance=this.node.worldPosition.clone().subtract(this.focusTarget.worldPosition).length()}}]),e}(u)).prototype,"focusTarget",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=e(g.prototype,"speedFactor",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),y=e(g.prototype,"_distance",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),e(g.prototype,"distance",[w],Object.getOwnPropertyDescriptor(g.prototype,"distance"),g.prototype),e(g.prototype,"preview",[w],Object.getOwnPropertyDescriptor(g.prototype,"preview"),g.prototype),e(g.prototype,"autoSetDistance",[w],Object.getOwnPropertyDescriptor(g.prototype,"autoSetDistance"),g.prototype),h=g))||h));n._RF.pop()}}}));

System.register("chunks:///_virtual/gameConfig.ts",["cc"],(function(e){"use strict";var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"811440YUb5BzbNy7sOs3g9h","gameConfig",void 0);e("gameConfig",{syncRate:10,moveSpeed:10,arrowFlyTime:500,arrowDistance:8,arrowAttackRadius:2,arrowDizzyTime:1e3});t._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index2.mjs","./index.mjs","./GameSystem.ts","./serviceProto.ts"],(function(e){"use strict";var t,n,s,r,a,i,c,u,o;return{setters:[function(e){t=e.createForOfIteratorHelperLoose,n=e.extends,s=e.createClass,r=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){i=e.cclegacy},function(e){c=e.WsClient},null,function(e){u=e.GameSystem},function(e){o=e.serviceProto}],execute:function(){i._RF.push({},"97737f6yq9OXo2sC0Kd8732","GameManager",void 0);e("GameManager",function(){function e(){var e,t=this;this.client=void 0,this.gameSystem=new u,this.lastServerState=this.gameSystem.state,this.lastRecvSetverStateTime=0,this.selfPlayerId=-1,this.lastSN=0,this.pendingInputMsgs=[];var n=this.client=new c(o,{server:"ws://multi.swink.co.kr:3005",json:!0,heartbeat:{interval:1e3,timeout:5e3}});n.listenMsg("server/Frame",(function(e){t._onServerSync(e)}));var s=parseInt((null==(e=location.search.match(/\blag=(\d+)/))?void 0:e[1])||"0");s&&(n.flows.preRecvDataFlow.push(r(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout(e,s)}));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})))),n.flows.preSendDataFlow.push(r(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout(e,s)}));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)}))))),window.gm=this}var i=e.prototype;return i.join=function(){var e=r(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.isConnected){e.next=8;break}return e.next=3,this.client.connect();case 3:if(e.sent.isSucc){e.next=8;break}return e.next=7,new Promise((function(e){setTimeout(e,2e3)}));case 7:return e.abrupt("return",this.join());case 8:return e.next=10,this.client.callApi("Join",{});case 10:if((t=e.sent).isSucc){e.next=17;break}if(!confirm("加入房间失败\n"+t.err.message+"\n是否重试 ?")){e.next=16;break}return e.abrupt("return",this.join());case 16:return e.abrupt("return");case 17:this.gameSystem.reset(t.res.gameState),this.lastServerState=Object.merge(t.res.gameState),this.lastRecvSetverStateTime=Date.now(),this.selfPlayerId=t.res.playerId;case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i._onServerSync=function(e){var s,r=this;this.gameSystem.reset(this.lastServerState);for(var a,i=t(e.inputs);!(a=i()).done;){var c=a.value;this.gameSystem.applyInput(c)}this.lastServerState=Object.merge({},this.gameSystem.state),this.lastRecvSetverStateTime=Date.now();var u=null!=(s=e.lastSn)?s:-1;this.pendingInputMsgs.remove((function(e){return e.sn<=u})),this.pendingInputMsgs.forEach((function(e){e.inputs.forEach((function(e){r.gameSystem.applyInput(n({},e,{playerId:r.selfPlayerId}))}))}))},i.sendClientInput=function(e){if(this.selfPlayerId&&this.client.isConnected){var t={sn:++this.lastSN,inputs:[e]};this.pendingInputMsgs.push(t),this.client.sendMsg("client/ClientInput",t),this.gameSystem.applyInput(n({},e,{playerId:this.selfPlayerId}))}},i.localTimePast=function(){this.gameSystem.applyInput({type:"TimePast",dt:Date.now()-this.lastRecvSetverStateTime}),this.lastRecvSetverStateTime=Date.now()},s(e,[{key:"state",get:function(){return this.gameSystem.state}}]),e}());i._RF.pop()}}}));

System.register("chunks:///_virtual/GameScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Arrow.ts","./Joystick.ts","./Player.ts","./FollowCamera.ts","./GameManager.ts","./gameConfig.ts"],(function(e){"use strict";var t,a,n,r,i,o,s,l,c,p,u,d,f,g,y,m,h,w,b,v,I,_;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,n=e.createForOfIteratorHelperLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,s=e._decorator,l=e.Prefab,c=e.Node,p=e.MeshRenderer,u=e.Color,d=e.Vec2,f=e.instantiate,g=e.Button,y=e.UIOpacity,m=e.Component},function(e){h=e.Arrow},function(e){w=e.Joystick},function(e){b=e.Player},function(e){v=e.FollowCamera},function(e){I=e.GameManager},function(e){_=e.gameConfig}],execute:function(){var M,P,S,k,A,C,z,x,F,j,D,G,O,T,L,N,B,H,R;o._RF.push({},"d4728cOzxlKHLMu5Xg48U8U","GameScene",void 0);var U=s.ccclass,J=s.property;e("GameScene",(M=U("GameScene"),P=J(w),S=J(l),k=J(l),A=J(c),C=J(c),z=J(v),x=J(c),F=J(c),M((G=t((D=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n))||this,r(t,"joyStick",G,i(t)),r(t,"prefabPlayer",O,i(t)),r(t,"prefabArrow",T,i(t)),r(t,"players",L,i(t)),r(t,"arrows",N,i(t)),r(t,"camera",B,i(t)),r(t,"btnAttack",H,i(t)),r(t,"attackPosIndicator",R,i(t)),t._playerInstances={},t._arrowInstances={},t._selfSpeed=new d(0,0),t}a(t,e);var o=t.prototype;return o.onLoad=function(){var e=this;window.game=this,this.attackPosIndicator.getComponent(p).material.setProperty("mainColor",u.CYAN),this.joyStick.options={onOperate:function(t){e._selfSpeed||(e._selfSpeed=new d),e._selfSpeed.set(t.x,t.y)},onOperateEnd:function(){e._selfSpeed=void 0}},this.gameManager=new I,this.gameManager.gameSystem.onNewArrow.push((function(t){e._onNewArrow(t)})),this.gameManager.client.flows.postDisconnectFlow.push((function(t){return setTimeout((function(){e.gameManager.join()}),2e3),t})),this.gameManager.join()},o.update=function(e){this.gameManager.localTimePast(),this._selfSpeed&&this._selfSpeed.lengthSqr()&&(this._selfSpeed.normalize().multiplyScalar(_.moveSpeed),this.gameManager.sendClientInput({type:"PlayerMove",speed:{x:this._selfSpeed.x,y:this._selfSpeed.y},dt:e})),this._updatePlayers(),this._updateAttackIndicator()},o._updatePlayers=function(){for(var e,t=this,a=this.gameManager.state.players,r=n(a);!(e=r()).done;){var i=e.value,o=this._playerInstances[i.id];if(!o){var s=f(this.prefabPlayer);this.players.addChild(s),(o=this._playerInstances[i.id]=s.getComponent(b)).init(i,i.id===this.gameManager.selfPlayerId),i.id===this.gameManager.selfPlayerId&&(this.camera.focusTarget=s)}o.updateState(i,this.gameManager.state.now)}for(var l=function(e){var a=t.players.children[e].getComponent(b);t.gameManager.state.players.find((function(e){return e.id===a.playerId}))||(a.node.removeFromParent(),delete t._playerInstances[a.playerId])},c=this.players.children.length-1;c>-1;--c)l(c)},o._onNewArrow=function(e){var t,a=this._arrowInstances[e.id];if(!a){var n=this.gameManager.state.players.find((function(t){return t.id===e.fromPlayerId}));if(n){var r=null==(t=this._playerInstances[n.id])?void 0:t.node;if(r){var i=f(this.prefabArrow);this.arrows.addChild(i),(a=this._arrowInstances[e.id]=i.getComponent(h)).init(e,r.position,this.gameManager.state.now)}}}},o.onBtnAttack=function(){var e,t=this,a=this.gameManager.state.players.find((function(e){return e.id===t.gameManager.selfPlayerId}));if(a){var n=null==(e=this._playerInstances[this.gameManager.selfPlayerId])?void 0:e.node;if(n){var r=n.forward.clone().normalize().multiplyScalar(_.arrowDistance),i=new d(a.pos.x,a.pos.y).add2f(r.x,-r.z);this.gameManager.sendClientInput({type:"PlayerAttack",targetPos:{x:i.x,y:i.y},targetTime:this.gameManager.state.now+_.arrowFlyTime}),this.btnAttack.getComponent(g).interactable=!1,this.btnAttack.getComponent(y).opacity=120,this.scheduleOnce((function(){t.btnAttack.getComponent(g).interactable=!0,t.btnAttack.getComponent(y).opacity=255}),1)}}},o._updateAttackIndicator=function(){var e,t=this;if(this.gameManager.state.players.find((function(e){return e.id===t.gameManager.selfPlayerId}))){var a=null==(e=this._playerInstances[this.gameManager.selfPlayerId])?void 0:e.node;if(a){var n=a.position.clone().add(a.forward.clone().normalize().multiplyScalar(_.arrowDistance));this.attackPosIndicator.setPosition(n.x,.1,n.z)}}},t}(m)).prototype,"joyStick",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=t(D.prototype,"prefabPlayer",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=t(D.prototype,"prefabArrow",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=t(D.prototype,"players",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=t(D.prototype,"arrows",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=t(D.prototype,"camera",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(D.prototype,"btnAttack",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(D.prototype,"attackPosIndicator",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j=D))||j));o._RF.pop()}}}));

System.register("chunks:///_virtual/GameSystem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./gameConfig.ts"],(function(t){"use strict";var e,r,s,a;return{setters:[function(t){e=t.extends,r=t.createClass},function(t){s=t.cclegacy},function(t){a=t.gameConfig}],execute:function(){s._RF.push({},"b4b89zse/NDgZ8ngy1oykcr","GameSystem",void 0);t("GameSystem",function(){function t(){this._state={now:0,players:[],arrows:[],nextArrowId:1},this.onNewArrow=[]}var s=t.prototype;return s.reset=function(t){this._state=Object.merge({},t)},s.applyInput=function(t){var r=this;if("PlayerMove"===t.type){var s=this._state.players.find((function(e){return e.id===t.playerId}));if(!s)return;if(s.dizzyEndTime&&s.dizzyEndTime>this._state.now)return;s.pos.x+=t.speed.x*t.dt,s.pos.y+=t.speed.y*t.dt}else if("PlayerAttack"===t.type){if(this._state.players.find((function(e){return e.id===t.playerId}))){var i={id:this._state.nextArrowId++,fromPlayerId:t.playerId,targetPos:e({},t.targetPos),targetTime:t.targetTime};this._state.arrows.push(i),this.onNewArrow.forEach((function(t){return t(i)}))}}else if("PlayerJoin"===t.type)this.state.players.push({id:t.playerId,pos:e({},t.pos)});else if("PlayerLeave"===t.type)this.state.players.remove((function(e){return e.id===t.playerId}));else if("TimePast"===t.type){this._state.now+=t.dt;for(var n=function(t){var e=r._state.arrows[t];e.targetTime<=r._state.now&&(r._state.players.filter((function(t){return(t.pos.x-e.targetPos.x)*(t.pos.x-e.targetPos.x)+(t.pos.y-e.targetPos.y)*(t.pos.y-e.targetPos.y)<=a.arrowAttackRadius*a.arrowAttackRadius})).forEach((function(t){t.dizzyEndTime=r._state.now+a.arrowDizzyTime})),r._state.arrows.splice(t,1))},o=this._state.arrows.length-1;o>-1;--o)n(o)}},r(t,[{key:"state",get:function(){return this._state}}]),t}());s._RF.pop()}}}));

System.register("chunks:///_virtual/Joystick.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MathUtil.ts"],(function(t){"use strict";var i,o,n,e,s,r,c,a,u,l,h;return{setters:[function(t){i=t.applyDecoratedDescriptor,o=t.inheritsLoose,n=t.createClass,e=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){r=t.cclegacy,c=t._decorator,a=t.Vec3,u=t.Node,l=t.Component},function(t){h=t.MathUtil}],execute:function(){var p,d,y,f,v,k,T,_;r._RF.push({},"ccc7fTjElVEQqB07I1JvC+N","Joystick",void 0);var b=c.ccclass,g=c.property,E=new a;t("Joystick",(p=b("Joystick"),d=g(u),y=g(u),p((k=i((v=function(t){function i(){for(var i,o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return i=t.call.apply(t,[this].concat(n))||this,e(i,"radius",k,s(i)),e(i,"disk",T,s(i)),e(i,"stick",_,s(i)),i._touchStartPos=void 0,i}o(i,t);var r=i.prototype;return r.onLoad=function(){this.node.on(u.EventType.TOUCH_START,this.onTouch,this),this.node.on(u.EventType.TOUCH_MOVE,this.onTouch,this),this.node.on(u.EventType.TOUCH_END,this.onTouchEnd,this),this.disk.active=!1},r.onTouch=function(t){var i;if(t.touch){this.disk.active=!0;var o=t.touch.getUILocation();this._touchStartPos||(this._touchStartPos=o.clone(),this.disk.setPosition(o.x,o.y,0));var n=this.disk.position,e=E.set(o.x-n.x,o.y-n.y,0),s=e.length();if(0!==s){var r=h.limit(s,0,this.radius);e.multiplyScalar(r/s),this.stick.setPosition(e),e.normalize(),null==(i=this.options)||i.onOperate({x:e.x||0,y:e.y||0})}else this.stick.setPosition(0,0,0)}},r.onTouchEnd=function(t){var i;this.disk.active=!1,this._touchStartPos=void 0,null==(i=this.options)||i.onOperateEnd()},n(i,[{key:"options",get:function(){return this._options},set:function(t){this._options=t}}]),i}(l)).prototype,"radius",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),T=i(v.prototype,"disk",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=i(v.prototype,"stick",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=v))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./env.ts","./migrate-canvas.ts","./Arrow.ts","./Joystick.ts","./Player.ts","./GameScene.ts","./FollowCamera.ts","./GameManager.ts","./MathUtil.ts","./TweenPool.ts","./GameSystem.ts","./gameConfig.ts","./ArrowState.ts","./PlayerState.ts","./PtlJoin.ts","./MsgClientInput.ts","./MsgFrame.ts","./serviceProto.ts"],(function(){"use strict";return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MathUtil.ts",["cc"],(function(t){"use strict";var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"6fde6fFDQlDiYxRm1e86H7h","MathUtil",void 0);t("MathUtil",function(){function t(){}return t.limit=function(t,i,n){return Math.min(n,Math.max(i,t))},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/migrate-canvas.ts",["cc"],(function(){"use strict";var n,e,t,i,r,o,a;return{setters:[function(c){n=c.cclegacy,e=c.director,t=c.Director,i=c.Canvas,r=c.Camera,o=c.game,a=c.Node}],execute:function(){n._RF.push({},"3f141c+VKdCPZwiDv5aHGNP","migrate-canvas",void 0);var c=1048575;function l(n,e){for(var t=0,i=n.children.length;t<i;t++)n.children[t].layer=e,l(n.children[t],e)}e.on(t.EVENT_AFTER_SCENE_LAUNCH,(function(){var n,t,a,s=null==(n=e.getScene())?void 0:n.children,m=null==(t=e.getScene())?void 0:t.getComponentsInChildren(i);if(!(m.length<=1)){m=m.filter((function(n){return!!n.cameraComponent}));var v=null==(a=e.getScene())?void 0:a.getComponentsInChildren(r),u=0;v.forEach((function(n){return u|=n.visibility&c}));for(var p=[],f=0,C=s.length;f<C;f++){var h=s[f];if(o.isPersistRootNode(h)){var d=h.getComponentsInChildren(i);0!==d.length&&p.push.apply(p,d.filter((function(n){return!!n.cameraComponent})))}}p.forEach((function(n){if(m.find((function(e){return e!==n&&e.cameraComponent.visibility&n.cameraComponent.visibility&c}))){var e=~u,t=e&~(e-1);n.cameraComponent.visibility=t|4293918720&n.cameraComponent.visibility,l(n.node,t),u|=e}}))}}));var s=a.prototype.setParent;function m(n){var e=0,t=n.getComponent(i);return t&&t.cameraComponent?e=t.cameraComponent.visibility&t.node.layer?t.node.layer:t.cameraComponent.visibility&~(t.cameraComponent.visibility-1):(n.parent&&(e=m(n.parent)),e)}a.prototype.setParent=function(n,e){if(s.call(this,n,e),n){var t=m(this);t&&(this.layer=t,l(this,t))}},n._RF.pop()}}}));

System.register("chunks:///_virtual/MsgClientInput.ts",["cc"],(function(){"use strict";var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"601af3zhydKB4UnBzvamjqH","MsgClientInput",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/MsgFrame.ts",["cc"],(function(){"use strict";var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"9d576jVbvlPGqqqAQlxibTU","MsgFrame",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/Player.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TweenPool.ts","./gameConfig.ts"],(function(t){"use strict";var e,i,s,n,a,r,o,l,h,u,c,d,f,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,r=t._decorator,o=t.SkeletalAnimation,l=t.MeshRenderer,h=t.Texture2D,u=t.Vec3,c=t.tween,d=t.Component},function(t){f=t.TweenPool},function(t){p=t.gameConfig}],execute:function(){var w,y,_,g,S,m,P,z,b,v,x;a._RF.push({},"720b7a4EnZJjYpzLWJrmvT/","Player",void 0);var T=r.ccclass,A=r.property;t("Player",(w=T("Player"),y=A(o),_=A(l),g=A(h),S=A(h),w((z=e((P=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,s(e,"ani",z,n(e)),s(e,"mesh",b,n(e)),s(e,"texSelf",v,n(e)),s(e,"texOther",x,n(e)),e.isSelf=!1,e.now=0,e._tweens=new f,e._targetPos=new u,e._lastAni=void 0,e}i(e,t);var a=e.prototype;return a.start=function(){this.ani.getState("win").speed=4},a.init=function(t,e){this.playerId=t.id,this.isSelf=e,this.mesh.material.setProperty("mainTexture",this.isSelf?this.texSelf:this.texOther)},a.updateState=function(t,e){this.state=t,this.now=e,t.dizzyEndTime&&t.dizzyEndTime>=e?this.setStatus("dizzy"):"win"===this._lastAni&&this.setStatus("idle"),this.isSelf?this._resetState(t,e):this._tweenState(t,e)},a._resetState=function(t,e){if(this._targetPos.set(t.pos.x,0,-t.pos.y),this.node.position.equals(this._targetPos))this.setStatus("idle");else{this.setStatus("run");var i=this._targetPos.clone().subtract(this.node.position).normalize();this.node.forward=new u(i),this.node.setPosition(this._targetPos)}},a._tweenState=function(t,e){var i=this,s=new u(t.pos.x,0,-t.pos.y);if(!this._targetPos.equals(s)){this._tweens.clear(),this.node.setPosition(this._targetPos);var n=new u(s).subtract(this.node.position).normalize();this._tweens.add(c({forward:this.node.forward}).to(.1,{forward:n},{onUpdate:function(t){i.node.forward=new u(t.forward)}}).start()),this._targetPos.set(s),this.setStatus("run"),this._tweens.add(c(this.node).to(1/p.syncRate,{position:this._targetPos}).call((function(){i.setStatus("idle")})).start())}},a.setStatus=function(t){var e=t;this.state.dizzyEndTime&&this.state.dizzyEndTime>=this.now&&(e="win"),this._lastAni!==e&&(this._lastAni=e,this.ani.crossFade(e,.1))},e}(d)).prototype,"ani",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=e(P.prototype,"mesh",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=e(P.prototype,"texSelf",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=e(P.prototype,"texOther",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=P))||m));a._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerState.ts",["cc"],(function(){"use strict";var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"cd3e0i5OPNKvJLUex+kxlnr","PlayerState",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/PtlJoin.ts",["cc"],(function(){"use strict";var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"6fc5dwiTTFBeKu2vaz+kNWq","PtlJoin",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/serviceProto.ts",["cc"],(function(e){"use strict";var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"b5788TO/1ZFxo8oAeaaS3Sl","serviceProto",void 0);e("serviceProto",{services:[{id:0,name:"client/ClientInput",type:"msg"},{id:1,name:"Join",type:"api"},{id:2,name:"server/Frame",type:"msg"}],types:{"client/MsgClientInput/MsgClientInput":{type:"Interface",properties:[{id:0,name:"sn",type:{type:"Number"}},{id:1,name:"inputs",type:{type:"Array",elementType:{type:"Reference",target:"client/MsgClientInput/ClientInput"}}}]},"client/MsgClientInput/ClientInput":{type:"Union",members:[{id:0,type:{target:{type:"Reference",target:"../game/GameSystem/PlayerMove"},keys:["playerId"],type:"Omit"}},{id:1,type:{target:{type:"Reference",target:"../game/GameSystem/PlayerAttack"},keys:["playerId"],type:"Omit"}}]},"../game/GameSystem/PlayerMove":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"PlayerMove"}},{id:1,name:"playerId",type:{type:"Number"}},{id:2,name:"speed",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:3,name:"dt",type:{type:"Number"}}]},"../game/GameSystem/PlayerAttack":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"PlayerAttack"}},{id:1,name:"playerId",type:{type:"Number"}},{id:2,name:"targetPos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:3,name:"targetTime",type:{type:"Number"}}]},"PtlJoin/ReqJoin":{type:"Interface"},"PtlJoin/ResJoin":{type:"Interface",properties:[{id:0,name:"playerId",type:{type:"Number"}},{id:1,name:"gameState",type:{type:"Reference",target:"../game/GameSystem/GameSystemState"}}]},"../game/GameSystem/GameSystemState":{type:"Interface",properties:[{id:0,name:"now",type:{type:"Number"}},{id:1,name:"players",type:{type:"Array",elementType:{type:"Reference",target:"../game/state/PlayerState/PlayerState"}}},{id:2,name:"arrows",type:{type:"Array",elementType:{type:"Reference",target:"../game/state/ArrowState/ArrowState"}}},{id:3,name:"nextArrowId",type:{type:"Number"}}]},"../game/state/PlayerState/PlayerState":{type:"Interface",properties:[{id:0,name:"id",type:{type:"Number"}},{id:1,name:"pos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}},{id:2,name:"dizzyEndTime",type:{type:"Number"},optional:!0}]},"../game/state/ArrowState/ArrowState":{type:"Interface",properties:[{id:0,name:"id",type:{type:"Number"}},{id:1,name:"fromPlayerId",type:{type:"Number"}},{id:2,name:"targetTime",type:{type:"Number"}},{id:3,name:"targetPos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}}]},"server/MsgFrame/MsgFrame":{type:"Interface",properties:[{id:0,name:"inputs",type:{type:"Array",elementType:{type:"Reference",target:"../game/GameSystem/GameSystemInput"}}},{id:1,name:"lastSn",type:{type:"Number"},optional:!0}]},"../game/GameSystem/GameSystemInput":{type:"Union",members:[{id:0,type:{type:"Reference",target:"../game/GameSystem/PlayerMove"}},{id:1,type:{type:"Reference",target:"../game/GameSystem/PlayerAttack"}},{id:2,type:{type:"Reference",target:"../game/GameSystem/PlayerJoin"}},{id:3,type:{type:"Reference",target:"../game/GameSystem/PlayerLeave"}},{id:4,type:{type:"Reference",target:"../game/GameSystem/TimePast"}}]},"../game/GameSystem/PlayerJoin":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"PlayerJoin"}},{id:1,name:"playerId",type:{type:"Number"}},{id:2,name:"pos",type:{type:"Interface",properties:[{id:0,name:"x",type:{type:"Number"}},{id:1,name:"y",type:{type:"Number"}}]}}]},"../game/GameSystem/PlayerLeave":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"PlayerLeave"}},{id:1,name:"playerId",type:{type:"Number"}}]},"../game/GameSystem/TimePast":{type:"Interface",properties:[{id:0,name:"type",type:{type:"Literal",literal:"TimePast"}},{id:1,name:"dt",type:{type:"Number"}}]}}});t._RF.pop()}}}));

System.register("chunks:///_virtual/TweenPool.ts",["cc"],(function(t){"use strict";var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"11f8cc8JuVNqbW5TpIjssea","TweenPool",void 0);t("TweenPool",function(){function t(){this._tweens=[]}var e=t.prototype;return e.add=function(t){this._tweens.push(t)},e.clear=function(){var t;null==(t=this._tweens)||t.forEach((function(t){return t.stop()})),this._tweens=[]},t}());e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});